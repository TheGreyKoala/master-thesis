\subsection{Funktionen und Schnittstellen}
    \label{section:solutionDetailsAnnotationServiceFunctions}
    Der {\annotationService} implementiert vor allem die
    Annotator Storage API\footnote{vgl. \url{http://docs.annotatorjs.org/en/v1.2.x/storage.html}},
    um die Nutzung dieser Bibliothek zu ermöglichen.
    Gleichzeitig ist seine Schnittstelle allgemein gehalten,
    sodass sie auch von anderen Systemen sinnvoll genutzt werden kann.
    Die Beschreibung der einzelnen Funktionen erfolgt in diesem Kapitel und
    gleicht in ihrem Format ähnlichen vorangegangenen
    Erläuterungen\footnote{vgl. Kapitel \ref{section:solutionDetailsClassificationServiceFunctions}}.

    \paragraph{Format einer Annotation}
    Annotationen tauscht der Service in einem JSON-Dokument aus,
    welches dem Format von Annotator folgt und um einige spezifische Angaben ergänzt.
    Jede Annotation spiegelt genau eine Feature der Klassifikation wieder.
    Eine Übersicht bietet Listing \ref{listing:annotationServiceAnnotationFormat}.

    \lstinputlisting[
        label=listing:annotationServiceAnnotationFormat,
        caption=Format einer Annotation,
        style=json
    ]{../resources/annotation-service/annotation.json}

    Die ID einer Annotation wird vom {\annotationService} automatisch
    generiert\footnote{vgl. Kapitel \ref{section:solutionDetailsAnnotationServiceMapping}}.
    Das Feld \texttt{text} bestimmt den Inhalt der Annotation,
    der hier immer der Namen des Features und dessen Klasse ist.
    Die Angaben im Feld \texttt{ranges} spiegeln den eindeutigen Selektor des Features wieder.
    Durch das Feld \texttt{user} identifiziert Annotator den Ersteller der Annotation,
    der in diesem Fall immer der imaginäre technische Benutzer \texttt{wccs} ist.
    Im Feld \texttt{permissions} werden die Rechte \texttt{admin} und \texttt{delete} auf diesen Nutzer beschränkt.
    Jeder kann dadurch Annotation lesen und bearbeiten.
    Änderungen an den Rechten sowie das Löschen einer Annotation bleibt aber dem Nutzer \texttt{wccs} vorbehalten.
    Die Eigenschaft \texttt{wccs} ist nicht durch Annotator vorgegeben,
    sondern stellt eine Ergänzung des \glspl{wccs} dar.
    Es speichert, ob es sich um ein {\contentFeature} oder ein {\referenceFeature} handel,
    und welche Klasse dieses besitzt.

    \paragraph{Bereitstellung von Metainformationen}
    Um der Annotator Storage API zu genügen,
    muss ein Endpunkt existieren,
    der Informationen über die Version der implementierten Schnittstelle
    enthält\footnote{vgl. \url{http://docs.annotatorjs.org/en/v1.2.x/storage.html\#root}}.
    Die entsprechende Schnittstelle ist in Tabelle
    \ref{table:annotationServiceMetaInterface} dokumentiert.

    \begin{table}[htb]
        \centering
        \begin{tabular}{|l|l|}
            \hline
            \textbf{\gls{url}} & \texttt{http://<HOST>:16612/pages/<PAGE\_ID>}\\
            \hline
            \textbf{Methode} & \texttt{GET}\\
            \hline
            \textbf{Statuscode} & \texttt{200 (OK)}\\
            \hline
            \textbf{Ausgabedokument} & \lstinputlisting[title=AnnotationServiceMetaInfo]{../resources/annotation-service/meta.json}\\
            \hline
        \end{tabular}
        \caption{Schnittstelle zum Abfragen von Metainformationen über den {\annotationService}}
        \label{table:annotationServiceMetaInterface}
    \end{table}

    Annotator erwartet von der konfigurierten Datenhaltung,
    dass sie die Annotationen genau einer Seite enthält.
    Die Anfrage-\gls{url} enthält deshalb die \gls{url} der klassifizierten Seite.

    \paragraph{Annotationen einer Seite abrufen}
    Zentrale Aufgabe des {\annotationService}s ist die Bereitstellung der Annotationen einer Seite.
    Hierfür bietet der Service die in Tabelle \ref{table:getAllAnnotationsInterface}
    dargestellte Schnittstelle.

    \begin{table}[htb]
        \centering
        \begin{tabular}{|l|l|}
            \hline
            \textbf{\gls{url}} & \texttt{http://<HOST>:16612/pages/<PAGE\_ID>/annotations}\\
            \hline
            \textbf{Methode} & \texttt{GET}\\
            \hline
            \textbf{Statuscode} & \texttt{200 (OK)}\\
            \hline
            \textbf{Ausgabedokument} & \texttt{Array von Annotationen}\\
            \hline
        \end{tabular}
        \caption{Schnittstelle zum Abfragen aller Annotationen einer Klassifikation}
        \label{table:getAllAnnotationsInterface}
    \end{table}

    Die Anfrage-\gls{url} identifiziert die klassifizierte Seite,
    an deren Annotationen Interesse besteht,
    über deren \gls{url}.
    Die Antwort des Services ist ein Array von Annotationen, wie sie im ersten Abschnitt vorgestellt wurden.

    \paragraph{Einzelne Annotation abfragen}
    Über die Schnittstelle in Tabelle \ref{table:getAnnotationInterface} kann eine einzelne
    Annotation anhand ihrer ID angefragt werden.

    \begin{table}[htb]
        \centering
        \begin{tabular}{|l|l|}
            \hline
            \textbf{\gls{url}} & \texttt{http://<HOST>:16612/pages/<PAGE\_ID>/annotations/<ANNOTATION\_ID>}\\
            \hline
            \textbf{Methode} & \texttt{GET}\\
            \hline
            \textbf{Statuscode} & \texttt{200 (OK)}\\
            \hline
            \textbf{Ausgabedokument} & \texttt{Annotation}\\
            \hline
        \end{tabular}
        \caption{Schnittstelle zum Abfragen einer einzelnen Annotation}
        \label{table:getAnnotationInterface}
    \end{table}

    \paragraph{Einzelne Annotation aktualisieren}
    Änderungen an einer Annotation können dem {\annotationService} über die Schnittstelle
    in Tabelle \ref{table:putAnnotationInterface} mitgeteilt werden.
    Als Resultat wird die Klasse des verknüpften Features
    überschrieben\footnote{vgl. Kapitel \ref{section:solutionDetailsAnnotationServiceMapping}}.

    \begin{table}[htb]
        \centering
        \begin{tabular}{|l|l|}
            \hline
            \textbf{\gls{url}} & \texttt{http://<HOST>:16612/pages/<PAGE\_ID>/annotations/<ANNOTATION\_ID>}\\
            \hline
            \textbf{Methode} & \texttt{PUT}\\
            \hline
            \textbf{Eingabedokument} & \texttt{Annotation}\\
            \hline
            \textbf{Statuscode} & \texttt{303 (See Other)}\\
            \hline
        \end{tabular}
        \caption{Schnittstelle zum Schreiben einer Annotation}
        \label{table:putAnnotationInterface}
    \end{table}

    Die Anfrage muss eine Annotation im oben beschriebenen Format enthalten.
    Die Antwort des Services enthält im Header \texttt{Location} die \gls{url} der geschriebenen Annotation.

    % TODO: Schnittstelle so, dass später auch anderes Format für Annotationen möglich